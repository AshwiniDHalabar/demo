
---TRIGGERS----
CREATE TABLE PROJECT1(
PROJECT_ID NUMBER(5) PRIMARY KEY,
START_DATE DATE,
END_DATE DATE,
NO_OF_EMP NUMBER(10),
BUDGET NUMBER(30),
CRT_DT DATE,
CRT_BY VARCHAR2(20),
UPDT_DT DATE,
UPD_BY VARCHAR2(20));

DESC PROJECT1;


----AUDIT SCENARIO----
CREATE OR REPLACE TRIGGER T_VAR_AUDIT 
BEFORE INSERT OR UPDATE
ON PROJECT1
FOR EACH ROW
BEGIN
IF INSERTING THEN
        :NEW.CRT_DT := SYSDATE;
        :NEW.CRT_BY := USER;
ELSE
        :NEW.UPDT_DT := SYSDATE;
        :NEW.UPD_BY := USER;
END IF;
END;


SELECT * FROM PROJECT1;
INSERT INTO PROJECT1(PROJECT_ID,START_DATE,END_DATE,NO_OF_EMP,BUDGET) VALUES(101,'22-05-2019','28-12-2022',500,2000000);
UPDATE PROJECT1 SET NO_OF_EMP=1000 WHERE PROJECT_ID=100;






----DYNAMIC SQL SCENARIO---
SELECT object_name, object_type FROM USER_OBJECTS;
SELECT owner, object_name, object_type FROM ALL_OBJECTS; 

SELECT * FROM USER_VIEWS;
SELECT * FROM USER_TABLES;
SELECT COUNT(*) FROM USER_TRIGGERS;
SELECT COUNT(*) FROM USER_TABLES;
SELECT COUNT(*) FROM TAB;
SELECT COUNT(*) FROM USER_CONSTRAINTS;


-----Write a Stored Procedure by passing a table name at run time and display all its details---
    --No of rows
    --No of columns
    --No of constraints
    --No of triggers

CREATE OR REPLACE PROCEDURE SP_DYNAMIC(VAR_TABLE VARCHAR2)AS
R_COUNT NUMBER(5);
V_CHAR VARCHAR2(200);
BEGIN
--NUMBER OF ROWS--
V_CHAR := 'SELECT COUNT(*)FROM '|| VAR_TABLE;
--DBMS_OUTPUT.PUT_LINE(V_CHAR);
EXECUTE IMMEDIATE V_CHAR INTO R_COUNT;
DBMS_OUTPUT.PUT_LINE('NUMBER OF ROWS ' ||R_COUNT);

--NUMBER OF COLUMNS--
V_CHAR := 'SELECT COUNT(*) FROM USER_TAB_COLUMNS WHERE TABLE_NAME=' ||''''||VAR_TABLE||'''';
--DBMS_OUTPUT.PUT_LINE(V_CHAR);
EXECUTE IMMEDIATE V_CHAR INTO R_COUNT;
DBMS_OUTPUT.PUT_LINE('NUMBER OF COLUMNS ' ||R_COUNT);

--NUMBER OF CONSTARINTS--
V_CHAR := 'SELECT COUNT(*) FROM USER_CONSTRAINTS WHERE TABLE_NAME=' ||''''||VAR_TABLE||'''';
--DBMS_OUTPUT.PUT_LINE(V_CHAR);
EXECUTE IMMEDIATE V_CHAR INTO R_COUNT;
DBMS_OUTPUT.PUT_LINE('NUMBER OF COLUMNS ' ||R_COUNT);

--NUMBER OF TRIGGERS--
V_CHAR := 'SELECT COUNT(*) FROM USER_TRIGGERS WHERE TABLE_NAME=' ||''''||VAR_TABLE||'''';
--DBMS_OUTPUT.PUT_LINE(V_CHAR);
EXECUTE IMMEDIATE V_CHAR INTO R_COUNT;
DBMS_OUTPUT.PUT_LINE('NUMBER OF COLUMNS ' ||R_COUNT);

EXCEPTION
WHEN OTHERS THEN
DBMS_OUTPUT.PUT_LINE('INVALID');
END;

EXEC SP_DYNAMIC('ACCOUNTSS');
SET SERVEROUTPUT ON;

SELECT * FROM ACCOUNTSS;
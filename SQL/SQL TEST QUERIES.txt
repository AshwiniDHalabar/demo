create table doctor1
(doc_id NUMBER(4) primary key,
DOCTOR_NAME varchar2(20),
SPECIALITY varchar2(20),
EMAIL_ID varchar2(20),
PHONE number(10)
);


create table patient1
(PAT_ID NUMBER(4) primary key,
PAT_NAME varchar2(20),
PAT_DOB DATE,
PAT_CITY VARCHAR2(20),
PAT_STATE VARCHAR2(20),
PT_PHONE number(10)
);
		
CREATE TABLE APPOINTMENT1 
(APT_ID NUMBER(10),
APP_DATE DATE,
PAT_ID NUMBER(4)references patient1(pat_id),
DOC_ID NUMBER(4) references DOCTOR1(DOC_id),
REASON_TO_CONSULT VARCHAR2(30));


INSERT INTO DOCTOR1 VALUES(201,	'SRIVIDYA','PHYSICIAN',	'sri@gmail.com',9374746736);
INSERT INTO DOCTOR1 VALUES(202,	'DEEPAK','ORTHOPEDIC',	'deepak@gmailcom', 9456375434);
INSERT INTO DOCTOR1 VALUES(203,	'SATISH','GENERAL SURGEON',	'sathis@gmail.com' ,8436254634);
INSERT INTO DOCTOR1 VALUES(204,	'GURUPRASAD','NEUROLOGIST'	,'guruprasad@gmail.com', 8763523541);
INSERT INTO DOCTOR1 VALUES(205,	'SREENIVAS MURTHY','ENT'	,'anjana@gmail.com', 9743675324);
INSERT INTO DOCTOR1 VALUES(206,	'PHANIBHUSHAN',	'PEIDIATRIC','phanibhshan@gmailcom' ,8765425674);




INSERT INTO PATIENT1 VALUES(1001,'MURHTY','12-02-2019','ERODE','TAMILNADU',9837436634);
INSERT INTO PATIENT1 VALUES(1002,'CHANDANA','05-07-2021','MYSORE','KARNATAKA',8297486946);
INSERT INTO PATIENT1 VALUES(1003,'ANUPAMA',	'10-04-1991','MANGALORE','KARNATAKA',289147464);
INSERT INTO PATIENT1 VALUES(1004,'SUKANYA',	'22-09-1992','BANGALORE','KARNATAKA',9436454534);
INSERT INTO PATIENT1 VALUES(1005,'PALLAVI',	'12-12-1975','KOLAR','KARNATAKA',9654543445);
INSERT INTO PATIENT1 VALUES(1006,'AKSHAY',	'08-05-1997','BANGALORE','KARNATAKA',9875644343);

INSERT INTO APPOINTMENT1 VALUES(50, '17-05-2022'	,  1001,    201,'FEVER AND COLD');
INSERT INTO APPOINTMENT1 VALUES(51,	'25-05-2022',	1006,	205,'THROAT INFECTION');
INSERT INTO APPOINTMENT1 VALUES(52,	'20-05-2022',	1005,	202,'LEG PAIN');
INSERT INTO APPOINTMENT1 VALUES(53,	'19-05-2022',	1004,	203,'DISCOMFORT IN STOMACH');
INSERT INTO APPOINTMENT1 VALUES(54,	'19-05-2022',	1004,	205	,'EAR CLEANING');
INSERT INTO APPOINTMENT1 VALUES(55,	'18-05-2022',	1003,	202	,'BACK PAIN');
INSERT INTO APPOINTMENT1 VALUES(56,	'25-05-2022',	1002,	206	,'FEVER AND COLD');
INSERT INTO APPOINTMENT1 VALUES(57,	'18-05-2022',	1001,	201	,'FOLLOW UP');
INSERT INTO APPOINTMENT1 VALUES(58,	'23-05-2022',	1002,	201	,'COLD');
INSERT INTO APPOINTMENT1 VALUES(60, '17-05-2022'	,  1001,    201,'FEVER');
SELECT * FROM DOCTOR1;
SELECT * FROM PATIENT1;
SELECT * FROM APPOINTMENT1;

UPDATE APPOINTMENT1 SET APP_DATE='25-05-2016' WHERE APT_ID=56;
--1)DISPLAY THE DOCTORS WHO DOES NOT HAVE ANY APPOINMENTS TODAY--
SELECT DOCTOR_NAME FROM DOCTOR1 D
WHERE DOC_ID NOT IN (SELECT DOC_ID FROM APPOINTMENT1 
                        WHERE TO_CHAR(APP_DATE,'DD-MM-YY')=TO_CHAR(SYSDATE,'DD-MM-YY'));
                        
SELECT DOC_ID FROM APPOINTMENT1
WHERE TO_CHAR(APP_DATE,'DD-MM-YY')=TO_CHAR(SYSDATE,'DD-MM-YY');


--2)DISPLAY DAYWISE NUMBER OF APPOINTMENTS IN THE CURRENT MONTH--
SELECT TO_CHAR(APP_DATE,'DY'),COUNT(APT_ID)
FROM APPOINTMENT1
WHERE TO_CHAR(APP_DATE,'MM-YYYY')=TO_CHAR(SYSDATE,'MM-YYYY')
GROUP BY TO_CHAR(APP_DATE,'DY');

--3)DISPLAY TOP 2 DOCTORS BASED ON NUMBER OF APPOINMENTS FROM LAST 3YEARS--
SELECT DOCTOR_NAME,S
FROM (SELECT D.DOC_ID,COUNT(APT_ID) S,DENSE_RANK() OVER (ORDER BY COUNT(APT_ID)DESC)RNK
        FROM DOCTOR1 D,APPOINTMENT1 A
        WHERE D.DOC_ID=A.DOC_ID AND TO_CHAR(APP_DATE,'YYYY')>TO_CHAR(SYSDATE,'YYYY')-3
        GROUP BY D.DOC_ID)R,DOCTOR1 D
        WHERE R.DOC_ID=D.DOC_ID
AND RNK<2;

----
SELECT DOCTOR_NAME,D.DOC_ID,UU
FROM (SELECT DOC_ID,COUNT(APT_ID)UU,DENSE_RANK() OVER (ORDER BY COUNT(APT_ID)DESC)RNK
        FROM APPOINTMENT1 A
        WHERE  TO_CHAR(APP_DATE,'YYYY')>TO_CHAR(SYSDATE,'YYYY')-3
        GROUP BY DOC_ID)R, DOCTOR1 D
        WHERE R.DOC_ID=D.DOC_ID      
AND  RNK<2;

---4)DISPLAY THE NO OF PATIENTS WHO HAVE TAKEN APPOINMENT MORE THAN 3TIMES IN CURRENT YEAR--
SELECT COUNT(A.PAT_ID),A.PAT_ID
FROM APPOINTMENT1 A,PATIENT1 P
WHERE P.PAT_ID=A.PAT_ID
AND TO_CHAR(APP_DATE,'YYYY')=TO_CHAR(SYSDATE,'YYYY')
GROUP BY A.PAT_ID
HAVING COUNT(A.PAT_ID)>3;

--5) DISPLAY THE YOUNGESHT PATIENT BASED ON AGE--
SELECT PAT_NAME
FROM PATIENT1
WHERE PAT_DOB =(SELECT MAX(PAT_DOB)
                FROM PATIENT1);



--6) DISPLAY ALL THE PATIENTS WHO TREATED BY THE DOCTOR WHOM THE PATIENT AKSHAY WAS TREATED--
SELECT PAT_NAME,DOCTOR_NAME
FROM DOCTOR1 D,PATIENT1 P,APPOINTMENT1 A
WHERE D.DOC_ID=A.DOC_ID AND A.PAT_ID=P.PAT_ID AND DOCTOR_NAME =( SELECT DOCTOR_NAME
                                                FROM DOCTOR1 D,PATIENT1 P,APPOINTMENT1 A
                                                WHERE D.DOC_ID=A.DOC_ID AND A.PAT_ID=P.PAT_ID
                                                AND PAT_NAME='AKSHAY');
--7)EXTRACT GAMIL FROM EMAILID COLUMN
SELECT SUBSTR(EMAIL_ID,INSTR(EMAIL_ID,'@')+1,INSTR(EMAIL_ID,'.')-INSTR(EMAIL_ID,'@')-1)FROM DOCTOR1;
-INSTR(EMAIL_ID,'.') FROM DOCTOR1;
SELECT SUBSTR(EMAIL_ID,(INSTR(EMAIL_ID,'.')+1)) FROM DOCTOR1;
SELECT (INSTR(EMAIL_ID,'@'))FROM DOCTOR1;


--8)DISPLAY THE COMMON DOCTORS WHOM MURTHY AND AKSHAY WAS TREATED--
SELECT DOCTOR_NAME
FROM DOCTOR1 D,PATIENT1 P,APPOINTMENT1 A
WHERE D.DOC_ID=A.DOC_ID AND A.PAT_ID=P.PAT_ID
AND PAT_NAME='MURHTY'
INTERSECT
SELECT DOCTOR_NAME
FROM DOCTOR1 D,PATIENT1 P,APPOINTMENT1 A
WHERE D.DOC_ID=A.DOC_ID AND A.PAT_ID=P.PAT_ID
AND PAT_NAME='AKSHAY';

UPDATE APPOINTMENT1 SET DOC_ID=201 WHERE APT_ID=51;
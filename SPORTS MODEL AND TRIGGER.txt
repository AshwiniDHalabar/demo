--4) BY UPDATING OR DELETING THE RECORDS IN PROJECT TABLE ,IT HAS TO GET STORE IN THE PROJECT_HISTORY TABLE.
CREATE OR REPLACE TRIGGER T_U_D_PROJECT
    BEFORE UPDATE OR DELETE 
    ON PROJECT1
    FOR EACH ROW
BEGIN
    IF UPDATING THEN
    INSERT INTO PROJECT_HISTORY VALUES(SEQ_UP_PROJECT.NEXTVAL,:OLD.PROJECT_ID,:OLD.START_DATE,:OLD.END_DATE,:OLD.NO_OF_EMP,:OLD.BUDGET,'N',SYSDATE,USER);
    ELSE
    INSERT INTO PROJECT_HISTORY VALUES(SEQ_UP_PROJECT.NEXTVAL,:OLD.PROJECT_ID,:OLD.START_DATE,:OLD.END_DATE,:OLD.NO_OF_EMP,:OLD.BUDGET,'Y',SYSDATE,USER);
    END IF;
END;

DROP TRIGGER T_U_D_PROJECT;
CREATE SEQUENCE SEQ_UP_PROJECT;
SELECT * FROM PROJECT_HISTORY;
SELECT * FROM PROJECT1;
UPDATE PROJECT1 SET NO_OF_EMP=50000 WHERE PROJECT_ID=101;
DELETE FROM PROJECT1 WHERE PROJECT_ID=100;

----SPORTS MODEL---
----ADDING TWO MORE TABLES---------
select to_char(sysdate,'mon') from dual;

CREATE TABLE PLAYERS
(PLAYER_ID NUMBER(4) PRIMARY KEY,
PLAYER_NAME VARCHAR2(20),
GAME VARCHAR2(20),
PLAYING_SINCE DATE,
PLAYER_DOJ DATE,
GENDER VARCHAR2(20));
DESC PLAYERS;
COMMIT;

CREATE TABLE TEAM_PLAYER
(T_P_ID NUMBER(4) PRIMARY KEY,
TEAM_ID NUMBER REFERENCES TEAM(TEAM_ID),
PLAYER_ID REFERENCES PLAYERS(PLAYER_ID),
START_DATE DATE,
END_DATE DATE,
CONTRACT_VALUE NUMBER(20),
GRADE CHAR(1));


INSERT INTO PLAYERS VALUES(350,'Kohli','Cricket','10-Feb-98','13-Mar-90','M');
INSERT INTO PLAYERS VALUES(351,'Surendra','Football','15-Aug-10','17-Apr-92','M');
INSERT INTO PLAYERS VALUES(352,'Manchi','Cricket','17-Jan-19','20-Mar-94','M');
INSERT INTO PLAYERS VALUES(353,'Marian','Cricket','12-Apr-20','16-May-95','M');

INSERT INTO TEAM_PLAYER VALUES(400,50,350,'01-Jan-10','01-Jan-13',50000000,'A');
INSERT INTO TEAM_PLAYER VALUES(401,50,352,'01-Feb-12','01-Feb-13',300000,'C');
INSERT INTO TEAM_PLAYER VALUES(402,50,353,'01-Apr-13','01-Apr-16',400000,'B');
INSERT INTO TEAM_PLAYER VALUES(403,51,351,'01-Nov-20','01-Nov-24',1000000,'A');
INSERT INTO TEAM_PLAYER VALUES(404,54,350,'01-Jan-22','01-Jan-24',60000000,'A');
INSERT INTO TEAM_PLAYER VALUES(405,54,352,'15-Mar-22','01-Mar-23',5000000,'B');

SELECT * FROM STADIUM1;
SELECT * FROM MATCH;
SELECT * FROM TEAM;
SELECT * FROM TEAM_OWNER;
SELECT * FROM PLAYERS;
SELECT  * FROM TEAM_PLAYER;
			
COMMIT;

-------QUESTIONS-------------
--1) Find the team names to which player Kohli played.-----
SELECT TEAM_NM 
FROM TEAM T,TEAM_PLAYER T1,PLAYERS P
WHERE T.TEAM_ID=T1.TEAM_ID AND P.PLAYER_ID=T1.PLAYER_ID
AND PLAYER_NAME='Kohli';

--2) Display the current team to which Marian is playing for.----
SELECT TEAM_NM
FROM TEAM T,TEAM_PLAYER T1,PLAYERS P
WHERE T.TEAM_ID=T1.TEAM_ID AND P.PLAYER_ID=T1.PLAYER_ID
AND PLAYER_NAME='Marian' AND SYSDATE BETWEEN START_DATE AND END_DATE;

--3) Find the number of players we have who is older than player SurendrA---
SELECT COUNT(PLAYER_ID)
FROM PLAYERS
WHERE PLAYER_DOJ <(SELECT PLAYER_DOJ 
                    FROM PLAYERS
                    WHERE PLAYER_NAME='Surendra');
                    
--4) Display team name and total contract value of players for that team.----
SELECT TEAM_NM,T1.PLAYER_ID,SUM(CONTRACT_VALUE)
FROM TEAM_PLAYER T1,TEAM T
WHERE T1.TEAM_ID=T.TEAM_ID
GROUP BY TEAM_NM,T1.PLAYER_ID;

--5) Display the team_name, player_name, start_date, end_date and the contract value---	
SELECT TEAM_NM,PLAYER_NAME,START_DATE,END_DATE,CONTRACT_VALUE
FROM TEAM T,TEAM_PLAYER T1,PLAYERS P
WHERE T.TEAM_ID=T1.TEAM_ID AND T1.PLAYER_ID=P.PLAYER_ID;


--6)Display all the players who were born in the month of April	---	
SELECT PLAYER_NAME 
FROM PLAYERS
WHERE TO_CHAR(PLAYER_DOJ,'MM')='04';

---7)Display all the players whose age is greater than 25 and who are either Grade B or 
                        Grade C Players	----------
SELECT DISTINCT PLAYER_NAME
FROM PLAYERS P,TEAM_PLAYER T1
WHERE P.PLAYER_ID=T1.PLAYER_ID 
AND TRUNC(MONTHS_BETWEEN(SYSDATE,PLAYER_DOJ)/12)>25 AND GRADE IN ('B','C');

--8)Display the player_name, team_name and team's manager name for all the cricket players---
SELECT PLAYER_NAME,TEAM_NM,MANAGER
FROM TEAM T,TEAM_PLAYER T1,PLAYERS P
WHERE T.TEAM_ID=T1.TEAM_ID AND T1.PLAYER_ID=P.PLAYER_ID
AND P.GAME='Cricket';

--9)Display the stadium_name, match_date, home_team_name, player_name (consider only home team 
                        players)------------
SELECT STA_NAME,MATCH_DATE,TEAM_NM,PLAYER_NAME
FROM STADIUM1 S,MATCH M,TEAM T, TEAM_PLAYER T1,PLAYERS P
WHERE S.STA_ID=M.STA_ID AND M.HOME_TEAM_ID=T.TEAM_ID AND
T.TEAM_ID=T1.TEAM_ID AND T1.PLAYER_ID=P.PLAYER_ID;

--10)Create view which gives the players and their current association team. If the sysdate is between the start_Date 
            and end_date that means they are working for that team.------								
CREATE VIEW VIEW_SPORTS AS
SELECT PLAYER_NAME,TEAM_NM
FROM TEAM T,TEAM_PLAYER T1,PLAYERS P
WHERE T.TEAM_ID=T1.TEAM_ID AND T1.PLAYER_ID=P.PLAYER_ID AND
SYSDATE BETWEEN START_DATE AND END_DATE;
      
SELECT * FROM VIEW_SPORTS;   